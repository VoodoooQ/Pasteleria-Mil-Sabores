<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carrito de Compras - Pastelería Mil Sabores</title>
  <link rel="stylesheet" href="estilos.css">
  <script src="funciones.js"></script>
</head>
<body>
  <nav>
    <a href="inicio.html">Inicio</a>
    <a href="catalogo.html">Productos</a>
    <a href="registro.html">Registro</a>
    <a href="inicioSesion.html">Iniciar Sesión</a>
    <a href="nosotros.html">Nosotros</a>
    <a href="contacto.html">Contacto</a>
    <a href="blogs.html">Blogs</a>
    <a href="carrito.html">Carrito</a>
  </nav>
  <h2>Carrito de Compras</h2>
  <div id="carrito-lista"></div>
  <div id="carrito-total"></div>
  <button class="btn" onclick="location.href='detalle_carrito.html'">Ir a Detalle de Compra</button>
  <div style="margin-top:1em;">
    <span style="font-weight:bold;color:#8B4513;">Compartir tu carrito:</span><br>
    <button class="btn" onclick="compartirRed('facebook')">Facebook</button>
    <button class="btn" onclick="compartirRed('whatsapp')">WhatsApp</button>
    <button class="btn" onclick="compartirRed('twitter')">X/Twitter</button>
    <button class="btn" onclick="compartirRed('telegram')">Telegram</button>
  </div>
  <script>
    function compartirRed(red) {
      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      let texto = '¡Mira mi pedido en Pastelería Mil Sabores!\n';
      carrito.forEach(p => {
        texto += `${p.nombre} x${p.cantidad} ${p.mensaje ? '('+p.mensaje+')' : ''}\n`;
      });
  let link = '';
  if (red === 'facebook') link = 'https://facebook.com';
  if (red === 'whatsapp') link = 'https://whatsapp.com';
  if (red === 'twitter') link = 'https://x.com';
  if (red === 'telegram') link = 'https://instagram.com';
  window.open(link, '_blank');
    }
  </script>
  <script src="funciones.js"></script>
  <script>
    function editarProducto(index) {
      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      const producto = carrito[index];
      const nuevoMensaje = prompt('Editar mensaje personalizado:', producto.mensaje || '');
      if (nuevoMensaje !== null) producto.mensaje = nuevoMensaje;
      const nuevoTamano = prompt('Editar tamaño (pequena, mediana, grande):', producto.tamano || '');
      if (nuevoTamano !== null && nuevoTamano !== '') producto.tamano = nuevoTamano;
      const nuevoTipo = prompt('Editar tipo (cuadrada, circular):', producto.tipo || '');
      if (nuevoTipo !== null && nuevoTipo !== '') producto.tipo = nuevoTipo;
      carrito[index] = producto;
      localStorage.setItem('carrito', JSON.stringify(carrito));
      mostrarCarritoEditable();
    }
    function mostrarCarritoEditable() {
      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      const usuario = JSON.parse(localStorage.getItem('usuario'));
      const lista = document.getElementById('carrito-lista');
      const totalDiv = document.getElementById('carrito-total');
      lista.innerHTML = '';
      let total = 0;
      carrito.forEach((producto, i) => {
        let precioOriginal = producto.precio;
        let precioFinal = precioOriginal;
        let descuentos = [];
        if (usuario) {
          if (usuario.descuento50) {
            precioFinal = Math.round(precioFinal * 0.5);
            descuentos.push('50% por edad');
          }
          if (usuario.descuento10) {
            precioFinal = Math.round(precioFinal * 0.9);
            descuentos.push('10% por código FELICES50');
          }
        }
        lista.innerHTML += `
          <div class="producto">
            <h3>${producto.nombre}</h3>
            <p>Precio original: $${precioOriginal}</p>
            <p>Descuentos: ${descuentos.length ? descuentos.join(', ') : 'Ninguno'}</p>
            <p>Precio final: $${precioFinal}</p>
            <p>Cantidad: ${producto.cantidad}</p>
            <p>Tipo: ${producto.tipo || '-'}</p>
            <p>Tamaño: ${producto.tamano || '-'}</p>
            <p>Mensaje: ${producto.mensaje || '-'}</p>
            <button class='btn' onclick='editarProducto(${i})'>Editar</button>
            <button class='btn' onclick="eliminarDelCarrito('${producto.codigo}')">Eliminar</button>
          </div>
        `;
        total += precioFinal * producto.cantidad;
      });
      let tortaGratisMsg = '';
      if (usuario && usuario.tortaGratis) {
        const hoy = new Date();
        const cumple = new Date(usuario.fecha);
        if (hoy.getDate() === cumple.getDate() && hoy.getMonth() === cumple.getMonth()) {
          tortaGratisMsg = '<p style="color:#8B4513;font-weight:bold;">¡Torta gratis por tu cumpleaños!</p>';
        }
      }
      totalDiv.innerHTML = `<h3>Total: $${total}</h3>${tortaGratisMsg}`;
    }
    mostrarCarritoEditable();
    window.eliminarDelCarrito = function(codigo) {
      let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      carrito = carrito.filter(p => p.codigo !== codigo);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      mostrarCarritoEditable();
    }
  </script>
</body>
</html>
